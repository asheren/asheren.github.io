---
layout: post
title: Rails Runner to the Rescue
date: '2016-02-26T15:37:00.000-05:00'
author: Allison McMillan
tags:
- rails
- becoming a developer
- fun tools
modified_time: '2016-02-26T15:37:07.126-05:00'
blogger_id: tag:blogger.com,1999:blog-6054545261088815023.post-846146818753424340
blogger_orig_url: http://allisonsherenmcmillan.blogspot.com/2016/02/rails-runner-to-rescue.html
---

Yes! I finally have something good and technical that I can blog about!! <br /><br />This week, I was working on one of our smaller applications. At GA, we send out surveys to students in order to get feedback on courses and programs and I was looking to add a new survey template. After becoming familiar with the codebase, I discovered that new surveys have previously been added by creating a bin file and then running that script since new surveys require tons of validations and therefore it is too complex to just add a survey via the console. And so that’s what I set off to do. Now, the actual creation of the survey wasn’t so difficult. The app is very modular and pretty clean and easy to understand. I finished up that task (as well as updated the readme to find this sort of information a bit easier) and then I said, ok great, well, now I have to deploy it to our staging environment. And so I sat for a moment and thought, well, how do I run a bin script only in staging. Enter <code>rails runner</code>. Rails Runner is an easy way to execute 1 file in an environment of your choosing. You can find a tiny bit more about rails runner in the rails docs <a href="http://guides.rubyonrails.org/command_line.html#rails-runner">here</a>.<br /><br />So based on <a href="http://stackoverflow.com/questions/4543744/how-to-run-a-simple-file-on-heroku">this post</a>  I ran what I thought was the correct command…<br /><br /><code>heroku run bundle exec rails runner ./bin/file_name -r staging</code><br /><br />and I got an error<br /><br /><code>/app/vendor/bundle/ruby/2.2.0/gems/railties-4.2.2/lib/rails/commands/runner.rb:62:in `eval': /app/vendor/bundle/ruby/2.2.0/gems/railties-4.2.2/lib/rails/commands/runner.rb:62: syntax error, unexpected '.' (SyntaxError)<br />./bin/file-name</code><br /><br />WHAT?!<br /><br />okay well, maybe I don’t need that ‘.’ in front of /bin and that is the issue. and so I ran<br /><br /><code>heroku run bundle exec rails runner bin/file_name -r staging</code><br /><br />and got another error<br /><br /><code>/app/vendor/bundle/ruby/2.2.0/gems/railties-4.2.2/lib/rails/commands/runner.rb:62:in `<top required="">': undefined local variable or method `bin' for main:Object (NameError)</top></code><br /><br />well, now I was confused. I obviously needed the ‘.’ there and the first error was pointing to a syntax error… was there a typo in my code? I looked (and had a colleague look as well) and couldn’t find anything. I searched and searched (there really isn’t much about rails runner, which is why I decided to write this blog post!). okay, a little while passed and so I said to myself “it’s time to pair!”<br /><br />I grabbed a colleague who suggested to see if we could even just get into the shell and then run the command from there, so I entered <code>heroku run bash</code>. Success! I’m in. Then we just did an ‘ls’ to make sure we were in the right place. Yup, right place. So then we did <code>ls bin</code> and the file wasn’t in the bin folder! Here’s where I had my moment… I thought that I needed to run the bin scripts BEFORE deploying the PR to staging so that the files would exist and the surveys would appear in our staging environment. HOWEVER, rails runner was looking into the staging code base in order to find the files but of course, they weren’t there because I hadn’t merged the branch in.<br /><br />Merged the branch in, and then ran <br /><br /><code>heroku run bundle exec rails runner ./bin/file_name -r staging</code><br /><br />and the problem was solved. Just a simple order of operations issue.